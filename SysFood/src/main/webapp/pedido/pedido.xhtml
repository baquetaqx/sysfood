<!DOCTYPE html>
<ui:composition template="/WEB-INF/templates/layoutPrincipal.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="title">SysFood - Dados da empresa</ui:define>
	<ui:define name="page-header">
		<h1 class="page-header">Realize o pedido</h1>
	</ui:define>
	<ui:define name="conteudo">
		<f:metadata>
			<f:viewAction action="#{cadastroPedidoBean.pesquisarProduto}" />
		</f:metadata>
		<div class="row">
			<h:form id="formPedido">
				<div class="col-lg-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
								<i class="fa fa-reorder"></i> Produtos
							</h3>
						</div>
						<div class="panel-body">

							<p:messages id="mensagens" closable="true" />
							<h:panelGrid columns="2" style="width:100%">
							Nome do Cliente:
							<h:panelGroup>
									<p:inputText styleClass="form-control"
										value="#{cadastroPedidoBean.pedido.cliente}"
										style="display:inline-table;width:70%; margin-right:5px"
										required="true" requiredMessage="Coloque o nome do cliente" />
									<p:commandButton icon="fa fa-plus"
										update=":formPedido:nomeCliente :formPedido:mensagens" />
								</h:panelGroup>
								<h:panelGroup>
									<br />
								Nome do Produto:
								</h:panelGroup>

								<h:panelGroup>
									<br />
									<p:inputText styleClass="form-control"
										value="#{cadastroPedidoBean.produtoFilter.nome}"
										style="display:inline-table;width:70%; margin-right:5px" />
									<p:commandButton icon="fa fa-search"
										update=":formPedido:tabelaProduto"
										action="#{cadastroPedidoBean.pesquisarProduto}" />
								</h:panelGroup>
							</h:panelGrid>
							<br />
							<p:dataTable paginator="true" rows="10"
								paginatorPosition="bottom" id="tabelaProduto"
								paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								rowsPerPageTemplate="5,10,15"
								value="#{cadastroPedidoBean.produtosFiltrados}" var="produto"
								emptyMessage="Nenhum produto encontrado">
								<p:column headerText="Nome do produto">
									<h:outputLabel value="#{produto.nome}" />
								</p:column>
								<p:column headerText="Valor UnitÃ¡rio" width="120">
									<h:outputLabel value="#{produto.preco}">
										<f:convertNumber type="currency" locale="pt-BR" />
									</h:outputLabel>
								</p:column>
								<p:column headerText="Etq" width="50">
									<h:outputLabel value="#{produto.quantidadeEstoque}" />
								</p:column>
								<p:column headerText="Add" width="50">
									<p:commandButton icon="fa fa-plus"
										action="#{cadastroPedidoBean.adicionarItem}"
										update=":formPedido:tabelaItens :formPedido:valorTotalPedido :formPedido:valorTotalPedidoDlg :formPedido:mensagens">
										<f:setPropertyActionListener
											target="#{cadastroPedidoBean.produto}" value="#{produto}" />
									</p:commandButton>
								</p:column>

							</p:dataTable>
						</div>
					</div>
				</div>
				<div class="col-lg-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
								<i class="fa fa-sort-amount-asc"></i> Cupom Fiscal
							</h3>
						</div>
						<div class="panel-body">

							<p:outputLabel value="Nome do Cliente: " />
							<p:outputLabel value="#{cadastroPedidoBean.pedido.cliente}"
								id="nomeCliente" />
							<p:dataTable value="#{cadastroPedidoBean.pedido.itens}"
								var="item" id="tabelaItens"
								paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								emptyMessage="Nenhum produto selecionado">
								<p:column headerText="Nome do produto" width="200">
									<p:outputLabel value="#{item.produto.nome}"
										styleClass="text-money" />
								</p:column>
								<p:column headerText="Qtd" width="50">
									<p:inputText value="#{item.quantidade}"
										styleClass="form-control" maxlength="2">
										<p:ajax event="keyup" process="@this"
											listener="#{cadastroPedidoBean.recalcularPedido}"
											update=":formPedido:tabelaItens :formPedido:valorTotalPedido :formPedido:valorTotalPedidoDlg" />
									</p:inputText>
								</p:column>
								<p:column headerText="Preco" width="80">
									<p:outputLabel value="#{item.produto.preco}"
										styleClass="text-money">
										<f:convertNumber type="currency" locale="pt-BR" />
									</p:outputLabel>
								</p:column>
								<p:column headerText="Pco Total" width="90">
									<p:outputLabel value="#{item.valorTotal}" id="pcoTotal"
										styleClass="text-money">
										<f:convertNumber type="currency" locale="pt-BR" />
									</p:outputLabel>
								</p:column>
								<p:column headerText="Rmv" width="50" style="text-align: center">
									<p:commandLink styleClass="fa fa-remove"
										action="#{cadastroPedidoBean.removerItem(item)}"
										process="@this"
										update=":formPedido:tabelaItens :formPedido:valorTotalPedido :formPedido:mensagens formPedido:valorTotalPedidoDlg" />
								</p:column>
							</p:dataTable>


							<hr class="zig" />
							<hr class="zag" />
							<h:panelGrid style="width:100%">
								<p:outputLabel id="valorTotalPedido"
									value="Valor Total R$: #{cadastroPedidoBean.pedido.valorTotal}"
									style="float:right">
									<f:convertNumber locale="pt-BR" type="currency" />
								</p:outputLabel>
							</h:panelGrid>

						</div>
						<br />
						<div class="centralizar">
							<p:commandButton value="Finalizar Pedido"
								styleClass="btn btn-success btn-lg btn-salvar"
								onclick="PF('dlg').show();"
								process="@this :formPedido:nomeCliente"
								update=":formPedido:mensagens" />
							<p:button value="Novo Pedido"
								styleClass="btn btn-danger btn-lg btn-salvar"
								outcome="/pedido/pedido.xhtml" />
						</div>
					</div>
				</div>
				<p:dialog header="Relizando o pagamento da venda" widgetVar="dlg"
					focus="money" modal="true" closable="true" resizable="false"
					id="dialogFinalizandoPedido">
					<div class="col-lg-6 bg-primary centralizar">
						<p:outputLabel value="Troco:" styleClass="centralizar" />
						<br />
						<h:outputLabel value="R$ #{cadastroPedidoBean.troco}"
							id="valorTroco" styleClass="texto-span moeda">
							<!-- <f:convertNumber type="currency" locale="pt-BR" /> -->
							<f:convertNumber pattern="#,##0.00"></f:convertNumber>
						</h:outputLabel>

					</div>

					<div class="col-lg-6 bg-info centralizar">
						<p:outputLabel value="Valor total: " styleClass="centralizar">
						</p:outputLabel>
						<br />
						<p:outputLabel value="#{cadastroPedidoBean.pedido.valorTotal}"
							styleClass="texto-span" id="valorTotalPedidoDlg">
							<f:convertNumber type="currency" locale="pt-BR" />
						</p:outputLabel>
					</div>

					<div class="col-lg-12">
						<hr class="zig" />
						<hr class="zag" />
						<h:panelGrid columns="2" cellpadding="5" style="width:100%">

							<h:outputLabel for="money" value="Dinheiro:" />
							<p:inputText id="money" label="money" styleClass="moeda"
								value="#{cadastroPedidoBean.valorPago}">
								<f:convertNumber minFractionDigits="2" maxFractionDigits="2"
									locale="pt-BR" />
								<p:ajax event="keyup" process="@this"
									listener="#{cadastroPedidoBean.calcularTroco}"
									update="formPedido:valorTroco" />
							</p:inputText>

							<br />
							<br />
							<f:facet name="footer">
								<center>
									<p:commandButton value="Concluir Venda"
										onclick="PF('dlg').hide()"
										action="#{cadastroPedidoBean.salvar}" update="@all"
										styleClass="btn btn-success btn-lg btn-salvar" />
								</center>
							</f:facet>
						</h:panelGrid>
					</div>
				</p:dialog>
			</h:form>
		</div>
		<!-- /.row -->
	</ui:define>
</ui:composition>